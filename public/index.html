<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>importã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œãƒ„ãƒ¼ãƒ«</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="./css/style.css" />
</head>
<body>
  <main class="tool-wrapper">
    <div class="tool-panel">
      <h1>ğŸª¶ importã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œãƒ„ãƒ¼ãƒ«</h1>

      <label>å®Ÿè¡Œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’é¸æŠ:</label>
      <select id="script">
        <option value="import_students.ts">import_students.tsï¼ˆå­¦ç”Ÿãƒã‚¹ã‚¿ç™»éŒ²ï¼‰</option>
        <option value="import_events.ts">import_events.tsï¼ˆã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ãƒ»æ›´æ–°ï¼‰</option>
        <option value="import_entries.ts">import_entries.tsï¼ˆå‡ºå ´è€…ç™»éŒ²ï¼‰</option>
        <option value="import_entries_group.ts">import_entries_group.tsï¼ˆé›†åˆæƒ…å ±ç™»éŒ²ï¼‰</option>
      </select>

      <label>CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ:</label>
      <input id="fileInput" type="file" accept=".csv" />

      <button id="runBtn">å®Ÿè¡Œ</button>
    </div>

    <pre id="console" class="console"></pre>
  </main>

  <script>
    document.getElementById('runBtn').addEventListener('click', async () => {
      const script = document.getElementById('script').value;
      const fileInput = document.getElementById('fileInput');
      const consoleBox = document.getElementById('console');

      if (!fileInput.files.length) {
        alert('CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
      }

      const file = fileInput.files[0];
      const formData = new FormData();
      formData.append('file', file);
      formData.append('script', script);

      consoleBox.innerText = 'â³ å®Ÿè¡Œä¸­ã§ã™...';
      consoleBox.classList.add('visible');

      try {
        const res = await fetch('/run-script', {
          method: 'POST',
          body: formData,
        });
        const data = await res.json();
        if (data.success === false) {
          consoleBox.classList.add('error');
          consoleBox.innerText = 'âŒ ã‚¨ãƒ©ãƒ¼:\n' + (data.output || data.error);
        } else {
          consoleBox.classList.remove('error');
          consoleBox.innerText = 'âœ… å®Ÿè¡Œå®Œäº†:\n' + (data.output || '');
        }
      } catch (err) {
        consoleBox.classList.add('error');
        consoleBox.innerText = 'âŒ é€šä¿¡ã‚¨ãƒ©ãƒ¼: ' + err.message;
      }
    });
  </script>
</body>
</html>
